{"version":3,"sources":["node_modules/perspective-transform/dist/perspective-transform.js","src/matrix.js","src/helpers.js","src/perspective.js"],"names":["transpose","exports","array","map","_","colIndex","row","matMul","a","b","aNumRows","length","aNumCols","bNumCols","m","Array","r","c","i","getRect","myPoints","width","height","firstPoint","secondPoint","wx","Math","abs","wy","hx","hy","sqrt","_perspectiveTransform","_interopRequireDefault","require","_matrix","_helpers","e","__esModule","default","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","_arrayLikeToArray","t","toString","call","slice","constructor","name","from","test","n","l","Symbol","iterator","u","f","o","next","Object","done","push","value","return","isArray","partyColor","canvasEle","document","getElementById","context","getContext","startPosition","x","y","lineCoordinates","isDrawStart","srcCoords","resultBoxWidth","resultBoxHeight","getClientOffset","event","rect","getBoundingClientRect","_ref","touches","pageX","pageY","left","top","window","scrollY","drawLine","beginPath","moveTo","lineTo","strokeStyle","stroke","mouseDownListener","mouseMoveListener","clearCanvas","mouseupListener","_event","clearRect","addEventListener","sourceImage","sourceCanvas","zoomCanvas","zoomContext","imageSmoothingEnabled","mozImageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled","addCrosshair","ctx","pxzoom","ev","offset","style","visibility","scaleFactor","naturalWidth","clientWidth","layerX","layerY","drawImage","status","addPoints","set","pretty","round","innerText","processImage","selectRect","restultingCoords","scaledSource","flat","perspT","pt","resultImg","src","H","coeffs","fullMatrix","noTranslate","transform","concat","canvas","createElement","inScreen","naturalHeight","getTransformedCanvas","then","img","catch","console","error","CSSTransform","_ref2","arguments","undefined","_ref3","iWidth","iHeight","Promise","res","rej","dim","getTransformedDimensions","xlinkNS","svgNS","svg","createElementNS","defs","image","setAttributeNS","toDataURL","setAttribute","innerHTML","appendChild","svgStr","XMLSerializer","serializeToString","Image","onload","onerror","URL","createObjectURL","Blob","type","orphan","parentNode","body","oldTrans","getComputedStyle","removeChild","changeImage","imgNum"],"mappings":"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Jf,CDIgB,CAAC,QCJjBA,CAAA;AHQpC,AGPA,EDIE,ADL+D,EAAC,AEC5DqD,EDIExC,EAAE,GAAGH,GCJG,CDIC,CAACC,CCJC,EDIE,CAACJ,MCJM,IDII,CAAC,CAAC,CAAC,GAAGA,UAAU,CAAC,CAAC,CAAC,CAAC;AFIpD,ACTkE,AEElE,EDIE,ECJI+C,EDIExC,EAAE,GAAGJ,ECJE,EDIE,CAACC,ACJA4C,GDIG,CAAChD,ICJI,CAACiD,KDIK,CAAC,CAAC,CAAC,GAAGjD,GCJG,CAAC,MDIM,CAAC,CAAC,CAAC,CAAC,KCJK,CAAC;AHQ1D,ACRA,AECA,EDKEF,EDNId,AECAkE,GDKC,GAAG/C,ADNE,CECC,EFDDzB,CCME,ACLEqE,CDKDvC,IAAI,CAACN,ADNR,CAAAlB,CCMU,CCLG,CAACmE,CDKDjD,EAAE,ADNf,GCMkBG,ADNf,ECMiB,ECLI,CDKDA,ACLE,EDKA,CAAC,CDNhCrB,AECmC,CAAC,KFD9BA,CAAIC,CAAC,EAAEC,CAAC,EAAK;ADSzB,AGPA,EDKEa,ADNA,EECEqD,EFDEjE,ECME,GAAGgB,GDNG,CCMC,CAACK,CDNCvB,AECA,CFDC,CAACG,CCMC,ACLA,CDKCkB,EAAE,EDNE,CCMCA,EAAE,GAAGC,EAAE,GAAGA,EAAE,CAAC;AFGvC,EEDE,ACPoB8C,CAAC,CFAnBhE,CEAqB,CAAC,GDOjB,GDPG,GAAGJ,CAAC,CAAC,CAAC,CAAC,CAACG,MAAM;ADS1B,EGT4BkE,CAAC,CDOlBxD,ADNPR,CED2B,IDOf,EAALQ,CDNC,GAAGZ,CCMC,ADNA,CAAC,CAAC,CAAC,CAACE,MAAM;ADS1B,AGViC,CAAC,GDOhBW,ADLdR,CAAC,GAAG,ECKgB,EAANQ,ADLNP,KAAK,CAACL,QAAQ,CAAC,CAAC,CAAC;ADS7B,AGVA,EDMyB,ADJvB,CCIwB,CCNtBoE,GFEG,IAAI9D,CAAC,GAAG,CAAC,EAAEA,CAAC,AEFA,GFEGN,AEFA,QFEQ,EAAE,EAAEM,CAAC,EAAE;ADSrC,AEJA,ECPwB4D,CAAC,CFGrB9D,CAAC,AEHsB,CFGrBE,AEHsB,CFGrB,CAAC,GAAG,IAAID,KAAK,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","file":"perspective.5b667178.js","sourceRoot":"..","sourcesContent":["\n// If the user is not including numeric.js already, add shim so this library works. Removes dependency on numeric.js\n\n(function(root) {\n\tif(root.numeric) {\n\t\treturn;\n\t}\n\n\telse{\n\t\tvar numeric = {};\n\n\t\tnumeric.dim = function dim(x) {\n    \t\tvar y,z;\n    \t\tif(typeof x === \"object\") {\n        \t\ty = x[0];\n        \t\tif(typeof y === \"object\") {\n            \t\tz = y[0];\n            \t\tif(typeof z === \"object\") {\n                \t\treturn numeric._dim(x);\n            \t\t}\n            \t\treturn [x.length,y.length];\n        \t\t}\n        \t\treturn [x.length];\n    \t\t}\n    \t\treturn [];\n\t\t};\n\n\t\tnumeric._foreach2 = (function _foreach2(x,s,k,f) {\n    \t\tif(k === s.length-1) { return f(x); }\n    \t\tvar i,n=s[k], ret = Array(n);\n    \t\tfor(i=n-1;i>=0;i--) { ret[i] = _foreach2(x[i],s,k+1,f); }\n    \t\treturn ret;\n\t\t});\n\n\t\tnumeric.cloneV = function (x) {\n\t\t\tvar _n = x.length;\n\t\t\tvar i, ret = Array(_n);\n\n\t\t\tfor(i=_n-1;i!==-1;--i) {\n\t\t\t\tret[i] = (x[i]);\n\t\t\t}\n\t\t\treturn ret;\n\t\t};\n\n\t\tnumeric.clone = function (x) {\n\t\t\tif(typeof x !== \"object\") return (x);\n\t\t\tvar V = numeric.cloneV;\n\t\t\tvar s = numeric.dim(x);\n\t\t\treturn numeric._foreach2(x,s,0,V);\n\t\t};\n\n\t\tnumeric.diag = function diag(d) {\n    \t\tvar i,i1,j,n = d.length, A = Array(n), Ai;\n    \t\tfor(i=n-1;i>=0;i--) {\n        \t\tAi = Array(n);\n        \t\ti1 = i+2;\n        \t\tfor(j=n-1;j>=i1;j-=2) {\n            \t\tAi[j] = 0;\n            \t\tAi[j-1] = 0;\n        \t\t}\n        \t\tif(j>i) { Ai[j] = 0; }\n        \t\tAi[i] = d[i];\n        \t\tfor(j=i-1;j>=1;j-=2) {\n            \t\tAi[j] = 0;\n            \t\tAi[j-1] = 0;\n        \t\t}\n        \t\tif(j===0) { Ai[0] = 0; }\n        \t\tA[i] = Ai;\n    \t\t}\n    \t\treturn A;\n\t\t};\n\n\t\tnumeric.rep = function rep(s,v,k) {\n    \t\tif(typeof k === \"undefined\") { k=0; }\n    \t\tvar n = s[k], ret = Array(n), i;\n    \t\tif(k === s.length-1) {\n        \t\tfor(i=n-2;i>=0;i-=2) { ret[i+1] = v; ret[i] = v; }\n        \t\tif(i===-1) { ret[0] = v; }\n        \t\treturn ret;\n    \t\t}\n    \t\tfor(i=n-1;i>=0;i--) { ret[i] = numeric.rep(s,v,k+1); }\n    \t\treturn ret;\n\t\t};\n\n\t\tnumeric.identity = function(n) { return numeric.diag(numeric.rep([n],1)); };\n\n\t\tnumeric.inv = function inv(a) {\n    \t\tvar s = numeric.dim(a), abs = Math.abs, m = s[0], n = s[1];\n    \t\tvar A = numeric.clone(a), Ai, Aj;\n    \t\tvar I = numeric.identity(m), Ii, Ij;\n    \t\tvar i,j,k,x;\n    \t\tfor(j=0;j<n;++j) {\n        \t\tvar i0 = -1;\n        \t\tvar v0 = -1;\n        \t\tfor(i=j;i!==m;++i) { k = abs(A[i][j]); if(k>v0) { i0 = i; v0 = k; } }\n        \t\tAj = A[i0]; A[i0] = A[j]; A[j] = Aj;\n        \t\tIj = I[i0]; I[i0] = I[j]; I[j] = Ij;\n        \t\tx = Aj[j];\n        \t\tfor(k=j;k!==n;++k)    Aj[k] /= x; \n        \t\tfor(k=n-1;k!==-1;--k) Ij[k] /= x;\n        \t\tfor(i=m-1;i!==-1;--i) {\n            \t\tif(i!==j) {\n                \t\tAi = A[i];\n                \t\tIi = I[i];\n                \t\tx = Ai[j];\n                \t\tfor(k=j+1;k!==n;++k)  Ai[k] -= Aj[k]*x;\n                \t\tfor(k=n-1;k>0;--k) { Ii[k] -= Ij[k]*x; --k; Ii[k] -= Ij[k]*x; }\n                \t\tif(k===0) Ii[0] -= Ij[0]*x;\n            \t\t}\n        \t\t}\n    \t\t}\n    \t\treturn I;\n\t\t};\n\n\t\tnumeric.dotMMsmall = function dotMMsmall(x,y) {\n    \t\tvar i,j,k,p,q,r,ret,foo,bar,woo,i0;\n    \t\tp = x.length; q = y.length; r = y[0].length;\n    \t\tret = Array(p);\n    \t\tfor(i=p-1;i>=0;i--) {\n        \t\tfoo = Array(r);\n        \t\tbar = x[i];\n        \t\tfor(k=r-1;k>=0;k--) {\n            \t\twoo = bar[q-1]*y[q-1][k];\n            \t\tfor(j=q-2;j>=1;j-=2) {\n                \t\ti0 = j-1;\n                \t\twoo += bar[j]*y[j][k] + bar[i0]*y[i0][k];\n            \t\t}\n            \t\tif(j===0) { woo += bar[0]*y[0][k]; }\n            \t\tfoo[k] = woo;\n        \t\t}\n        \t\tret[i] = foo;\n    \t\t}\n    \t\treturn ret;\n\t\t};\n\n\t\tnumeric.dotMV = function dotMV(x,y) {\n    \t\tvar p = x.length, i;\n    \t\tvar ret = Array(p), dotVV = numeric.dotVV;\n    \t\tfor(i=p-1;i>=0;i--) { ret[i] = dotVV(x[i],y); }\n    \t\treturn ret;\n\t\t};\n\n\t\tnumeric.dotVV = function dotVV(x,y) {\n    \t\tvar i,n=x.length,i1,ret = x[n-1]*y[n-1];\n    \t\tfor(i=n-2;i>=1;i-=2) {\n        \t\ti1 = i-1;\n        \t\tret += x[i]*y[i] + x[i1]*y[i1];\n    \t\t}\n    \t\tif(i===0) { ret += x[0]*y[0]; }\n    \t\treturn ret;\n\t\t};\n\n\t\tnumeric.transpose = function transpose(x) {\n    \t\tvar i,j,m = x.length,n = x[0].length, ret=Array(n),A0,A1,Bj;\n    \t\tfor(j=0;j<n;j++) ret[j] = Array(m);\n    \t\tfor(i=m-1;i>=1;i-=2) {\n        \t\tA1 = x[i];\n        \t\tA0 = x[i-1];\n        \t\tfor(j=n-1;j>=1;--j) {\n            \t\tBj = ret[j]; Bj[i] = A1[j]; Bj[i-1] = A0[j];\n            \t\t--j;\n            \t\tBj = ret[j]; Bj[i] = A1[j]; Bj[i-1] = A0[j];\n        \t\t}\n        \t\tif(j===0) {\n            \t\tBj = ret[0]; Bj[i] = A1[0]; Bj[i-1] = A0[0];\n        \t\t}\n    \t\t}\n    \t\tif(i===0) {\n        \t\tA0 = x[0];\n        \t\tfor(j=n-1;j>=1;--j) {\n            \t\tret[j][0] = A0[j];\n            \t\t--j;\n            \t\tret[j][0] = A0[j];\n        \t\t}\n        \t\tif(j===0) { ret[0][0] = A0[0]; }\n    \t\t}\n    \t\treturn ret;\n\t\t};\n\n        this.numeric = numeric;\n\t\troot.numeric = numeric;\n\t}\n\n}(this));\n\n\n(function(global, factory) {\n\tif(typeof exports === 'object' && typeof module !== undefined){\n\t\tmodule.exports = factory();\n\t}\n\telse if(typeof define === 'function' && define.amd){\n\t\tdefine(factory);\n\t}\n\telse{\n\t\tglobal.PerspT = factory();\n\t}\n}(this, function() {\n\t'use strict';\n\n    function round(num){\n        return Math.round(num*10000000000)/10000000000;\n    }\n\n\tfunction getNormalizationCoefficients(srcPts, dstPts, isInverse){\n\t\tif(isInverse){\n\t\t\tvar tmp = dstPts;\n\t\t\tdstPts = srcPts;\n\t\t\tsrcPts = tmp;\n\t\t}\n\t\tvar r1 = [srcPts[0], srcPts[1], 1, 0, 0, 0, -1*dstPts[0]*srcPts[0], -1*dstPts[0]*srcPts[1]];\n\t\tvar r2 = [0, 0, 0, srcPts[0], srcPts[1], 1, -1*dstPts[1]*srcPts[0], -1*dstPts[1]*srcPts[1]];\n\t\tvar r3 = [srcPts[2], srcPts[3], 1, 0, 0, 0, -1*dstPts[2]*srcPts[2], -1*dstPts[2]*srcPts[3]];\n\t\tvar r4 = [0, 0, 0, srcPts[2], srcPts[3], 1, -1*dstPts[3]*srcPts[2], -1*dstPts[3]*srcPts[3]];\n\t\tvar r5 = [srcPts[4], srcPts[5], 1, 0, 0, 0, -1*dstPts[4]*srcPts[4], -1*dstPts[4]*srcPts[5]];\n\t\tvar r6 = [0, 0, 0, srcPts[4], srcPts[5], 1, -1*dstPts[5]*srcPts[4], -1*dstPts[5]*srcPts[5]];\n\t\tvar r7 = [srcPts[6], srcPts[7], 1, 0, 0, 0, -1*dstPts[6]*srcPts[6], -1*dstPts[6]*srcPts[7]];\n\t\tvar r8 = [0, 0, 0, srcPts[6], srcPts[7], 1, -1*dstPts[7]*srcPts[6], -1*dstPts[7]*srcPts[7]];\n\n\t\tvar matA = [r1, r2, r3, r4, r5, r6, r7, r8];\n\t\tvar matB = dstPts;\n        var matC;\n\t\n\t\ttry{\n\t    \tmatC = numeric.inv(numeric.dotMMsmall(numeric.transpose(matA), matA));\n\t\t}catch(e){\n\t    \tconsole.log(e);\n\t    \treturn [1,0,0,0,1,0,0,0];\n\t\t}\n\n\t\tvar matD = numeric.dotMMsmall(matC, numeric.transpose(matA));\n\t\tvar matX = numeric.dotMV(matD, matB);\n        for(var i = 0; i < matX.length; i++) {\n            matX[i] = round(matX[i]);\n        }\n        matX[8] = 1;\n\n\t\treturn matX;\n\t}\n\n\tfunction PerspT(srcPts, dstPts){\n\t\tif( (typeof window !== 'undefined' && window === this) || this === undefined) {\n\t\t\treturn new PerspT(srcPts, dstPts);\n\t\t}\n\n\t\tthis.srcPts = srcPts;\n\t\tthis.dstPts = dstPts;\n\t\tthis.coeffs = getNormalizationCoefficients(this.srcPts, this.dstPts, false);\n\t\tthis.coeffsInv = getNormalizationCoefficients(this.srcPts, this.dstPts, true);\n\n\t\treturn this;\n\t}\n\n\tPerspT.prototype = {\n\t\ttransform: function(x,y) {\n\t\t\tvar coordinates = [];\n\t\t\tcoordinates[0] = (this.coeffs[0]*x + this.coeffs[1]*y + this.coeffs[2]) / (this.coeffs[6]*x + this.coeffs[7]*y + 1);\n\t\t\tcoordinates[1] = (this.coeffs[3]*x + this.coeffs[4]*y + this.coeffs[5]) / (this.coeffs[6]*x + this.coeffs[7]*y + 1);\n\t\t\treturn coordinates;\n\t\t},\n\n\t\ttransformInverse: function(x,y) {\n\t\t\tvar coordinates = [];\n\t\t\tcoordinates[0] = (this.coeffsInv[0]*x + this.coeffsInv[1]*y + this.coeffsInv[2]) / (this.coeffsInv[6]*x + this.coeffsInv[7]*y + 1);\n\t\t\tcoordinates[1] = (this.coeffsInv[3]*x + this.coeffsInv[4]*y + this.coeffsInv[5]) / (this.coeffsInv[6]*x + this.coeffsInv[7]*y + 1);\n\t\t\treturn coordinates;\n\t\t}\n\t};\n\n\treturn PerspT;\n\n}));","// this is necessary due to the stupid order of transform matrix\r\nconst transpose = (array) =>\r\n  array[0].map((_, colIndex) => array.map((row) => row[colIndex]));\r\n\r\nconst matMul = (a, b) => {\r\n  let aNumRows = a.length,\r\n    aNumCols = a[0].length,\r\n    bNumCols = b[0].length,\r\n    m = new Array(aNumRows); // initialize array of rows\r\n  for (let r = 0; r < aNumRows; ++r) {\r\n    m[r] = new Array(bNumCols); // initialize the current row\r\n    for (let c = 0; c < bNumCols; ++c) {\r\n      m[r][c] = 0; // initialize the current cell\r\n      for (let i = 0; i < aNumCols; ++i) {\r\n        m[r][c] += a[r][i] * b[i][c];\r\n      }\r\n    }\r\n  }\r\n  return m;\r\n};\r\n\r\nexport { transpose, matMul };\r\n","export function getRect(myPoints) {\n  let width, height;\n  const firstPoint = myPoints[0];\n  const secondPoint = myPoints[1];\n\n  const wx = Math.abs(firstPoint[0] - secondPoint[0]);\n  const wy = Math.abs(firstPoint[1] - secondPoint[1]);\n  const hx = Math.abs(firstPoint[0] - firstPoint[2]);\n  const hy = Math.abs(firstPoint[1] - firstPoint[3]);\n\n  width = Math.sqrt(wx * wx + wy * wy);\n  height = Math.sqrt(hx * hx + hy * hy);\n\n  return { width, height };\n}\n","import { default as pt } from \"perspective-transform\";\r\nimport { transpose } from \"./matrix\";\r\nimport { getRect } from \"./helpers\";\r\nconst partyColor = \"#DB14C1\";\r\nconst canvasEle = document.getElementById(\"drawContainer\");\r\nconst context = canvasEle.getContext(\"2d\");\r\nlet startPosition = { x: 0, y: 0 };\r\nlet lineCoordinates = { x: 0, y: 0 };\r\nlet isDrawStart = false;\r\nconst srcCoords = [[null], [null]];\r\nlet resultBoxWidth, resultBoxHeight;\r\n\r\n// Failing if scrolled down - update\r\nconst getClientOffset = (event) => {\r\n  const rect = canvasEle.getBoundingClientRect();\r\n  const { pageX, pageY } = event.touches ? event.touches[0] : event;\r\n  const x = pageX - rect.left;\r\n  const y = pageY - rect.top - window.scrollY;\r\n\r\n  return { x, y };\r\n};\r\n\r\nconst drawLine = () => {\r\n  context.beginPath();\r\n  context.moveTo(startPosition.x, startPosition.y);\r\n  context.lineTo(lineCoordinates.x, lineCoordinates.y);\r\n  context.strokeStyle = partyColor;\r\n  context.stroke();\r\n};\r\n\r\nconst mouseDownListener = (event) => {\r\n  startPosition = getClientOffset(event);\r\n  isDrawStart = true;\r\n};\r\n\r\nconst mouseMoveListener = (event) => {\r\n  if (!isDrawStart) return;\r\n\r\n  lineCoordinates = getClientOffset(event);\r\n  clearCanvas();\r\n  drawLine();\r\n};\r\n\r\nconst mouseupListener = (_event) => {\r\n  isDrawStart = false;\r\n};\r\n\r\nconst clearCanvas = () => {\r\n  context.clearRect(0, 0, canvasEle.width, canvasEle.height);\r\n};\r\n\r\ncanvasEle.addEventListener(\"mousedown\", mouseDownListener);\r\ncanvasEle.addEventListener(\"mousemove\", mouseMoveListener);\r\ncanvasEle.addEventListener(\"mouseup\", mouseupListener);\r\n\r\ncanvasEle.addEventListener(\"touchstart\", mouseDownListener);\r\ncanvasEle.addEventListener(\"touchmove\", mouseMoveListener);\r\ncanvasEle.addEventListener(\"touchend\", mouseupListener);\r\n\r\n// ZOOM stuffs\r\nconst sourceImage = document.getElementById(\"card\");\r\nconst sourceCanvas = document.getElementById(\"drawContainer\");\r\nconst zoomCanvas = document.getElementById(\"zoomCanvas\");\r\nconst zoomContext = zoomCanvas.getContext(\"2d\");\r\nzoomContext.imageSmoothingEnabled = false;\r\nzoomContext.mozImageSmoothingEnabled = false;\r\nzoomContext.webkitImageSmoothingEnabled = false;\r\nzoomContext.msImageSmoothingEnabled = false;\r\n\r\nfunction addCrosshair(ctx, c) {\r\n  const x = c.width / 2;\r\n  const y = c.height / 2;\r\n  ctx.moveTo(x, y - 10);\r\n  ctx.lineTo(x, y + 10);\r\n  ctx.moveTo(x - 10, y);\r\n  ctx.lineTo(x + 10, y);\r\n  ctx.strokeStyle = partyColor;\r\n  ctx.stroke();\r\n}\r\n\r\nfunction pxzoom(ev) {\r\n  const offset = 10;\r\n  const rect = canvasEle.getBoundingClientRect();\r\n  zoomCanvas.style.visibility = \"visible\";\r\n  const scaleFactor = sourceImage.naturalWidth / sourceImage.clientWidth;\r\n  const x = ev.layerX * scaleFactor;\r\n  const y = ev.layerY * scaleFactor;\r\n  zoomCanvas.style.left = ev.layerX + rect.left + offset + \"px\";\r\n  zoomCanvas.style.top = ev.layerY + rect.top + window.scrollY + offset + \"px\";\r\n  zoomContext.drawImage(\r\n    sourceImage,\r\n    Math.abs(x - 5),\r\n    Math.abs(y - 5),\r\n    10,\r\n    10,\r\n    0,\r\n    0,\r\n    100,\r\n    100\r\n  );\r\n  addCrosshair(zoomContext, zoomCanvas);\r\n}\r\n\r\nsourceCanvas.addEventListener(\"mousemove\", pxzoom, false);\r\nsourceCanvas.addEventListener(\r\n  \"mouseout\",\r\n  (ev) => (zoomCanvas.style.visibility = \"hidden\")\r\n);\r\n\r\nconst status = document.getElementById(\"statusBox\");\r\nfunction addPoints(set) {\r\n  srcCoords[set] = [\r\n    startPosition.x,\r\n    startPosition.y,\r\n    lineCoordinates.x,\r\n    lineCoordinates.y\r\n  ];\r\n  const pretty = srcCoords.map((i) => i.map(Math.round));\r\n  status.innerText = \"Input Coords: \" + pretty.toString();\r\n}\r\n\r\nconst processImage = () => {\r\n  const scaleFactor = sourceImage.naturalWidth / sourceImage.clientWidth;\r\n  const selectRect = getRect(srcCoords);\r\n  resultBoxWidth = selectRect.width * scaleFactor;\r\n  resultBoxHeight = selectRect.height * scaleFactor;\r\n\r\n  // prettier-ignore\r\n  const restultingCoords = [\r\n    0,                  0,\r\n    0,                  resultBoxHeight,\r\n    resultBoxWidth,     0,\r\n    resultBoxWidth,     resultBoxHeight\r\n  ];\r\n\r\n  const scaledSource = srcCoords.flat().map((x) => x * scaleFactor);\r\n  const perspT = pt(scaledSource, restultingCoords);\r\n  // draw fixed image\r\n  const resultImg = document.getElementById(\"result\");\r\n  resultImg.src = sourceImage.src;\r\n  const H = perspT.coeffs;\r\n  // prettier-ignore\r\n  const fullMatrix = [\r\n    [H[0],   H[1],   0, H[2]],\r\n    [H[3],   H[4],   0, H[5]],\r\n    [   0,      0,   1,    0],\r\n    [H[6],   H[7],   0, H[8]]\r\n  ]\r\n\r\n  // prettier-ignore\r\n  const noTranslate = [\r\n    [H[0],   H[1],   0,    0],\r\n    [H[3],   H[4],   0,    0],\r\n    [   0,      0,   1,    0],\r\n    [H[6],   H[7],   0, H[8]]\r\n  ]\r\n\r\n  // Show with simple CSS transform\r\n  resultImg.style.transform = `matrix3d(${transpose(noTranslate)})`;\r\n\r\n  // madness\r\n  const canvas = document.createElement(\"canvas\");\r\n  const inScreen = document.getElementById(\"resultCanvas\");\r\n\r\n  canvas.width = sourceImage.naturalWidth;\r\n  canvas.height = sourceImage.naturalHeight;\r\n\r\n  const ctx = canvas.getContext(\"2d\");\r\n  ctx.drawImage(sourceImage, 0, 0);\r\n  getTransformedCanvas(canvas, `matrix3d(${transpose(fullMatrix)})`, [\r\n    resultBoxWidth,\r\n    resultBoxHeight\r\n  ])\r\n    .then(function (img) {\r\n      inScreen.width = img.naturalWidth;\r\n      inScreen.height = img.naturalHeight;\r\n      inScreen.getContext(\"2d\").drawImage(img, 0, 0);\r\n    })\r\n    .catch(console.error);\r\n};\r\n\r\ndocument\r\n  .getElementById(\"firstLine\")\r\n  .addEventListener(\"click\", () => addPoints(0));\r\ndocument\r\n  .getElementById(\"secondLine\")\r\n  .addEventListener(\"click\", () => addPoints(1));\r\n\r\ndocument\r\n  .getElementById(\"processTransform\")\r\n  .addEventListener(\"click\", processImage);\r\n\r\n// This function attempts to mimic CSS 3D transforms onto a canvas\r\n// so the result can be saved.  This does so via SVG intermediate\r\n// Unfortunately SVG 3D is not exactly the same as CSS 3D ðŸ˜¢\r\n//https://stackoverflow.com/questions/27177386/svg-matrix3d-renders-differently-in-different-browser\r\nfunction getTransformedCanvas(\r\n  canvas,\r\n  CSSTransform,\r\n  [iWidth, iHeight] = [null, null]\r\n) {\r\n  return new Promise(function (res, rej) {\r\n    const dim = getTransformedDimensions(canvas, CSSTransform);\r\n    const xlinkNS = \"http://www.w3.org/1999/xlink\",\r\n      svgNS = \"http://www.w3.org/2000/svg\";\r\n    const svg = document.createElementNS(svgNS, \"svg\"),\r\n      defs = document.createElementNS(svgNS, \"defs\"),\r\n      style = document.createElementNS(svgNS, \"style\"),\r\n      image = document.createElementNS(svgNS, \"image\");\r\n    image.setAttributeNS(xlinkNS, \"href\", canvas.toDataURL());\r\n    image.setAttribute(\"width\", canvas.width);\r\n    image.setAttribute(\"height\", canvas.height);\r\n    style.innerHTML = \"image{transform:\" + CSSTransform + \";}\";\r\n    svg.appendChild(defs);\r\n    defs.appendChild(style);\r\n\r\n    svg.appendChild(image);\r\n    svg.setAttribute(\"width\", iWidth || dim.width);\r\n    svg.setAttribute(\"height\", iHeight || dim.height);\r\n    const svgStr = new XMLSerializer().serializeToString(svg);\r\n    const img = new Image();\r\n    img.onload = function () {\r\n      res(img);\r\n    };\r\n    img.onerror = rej;\r\n    img.src = URL.createObjectURL(\r\n      new Blob([svgStr], { type: \"image/svg+xml\" })\r\n    );\r\n  });\r\n}\r\n\r\nfunction getTransformedDimensions(canvas, CSSTransform) {\r\n  const orphan = !canvas.parentNode;\r\n  if (orphan) document.body.appendChild(canvas);\r\n  const oldTrans = getComputedStyle(canvas).transform;\r\n  canvas.style.transform = CSSTransform;\r\n  const rect = canvas.getBoundingClientRect();\r\n  canvas.style.transform = oldTrans;\r\n  if (orphan) document.body.removeChild(canvas);\r\n  return rect;\r\n}\r\n\r\nfunction changeImage(imgNum) {\r\n  sourceImage.src = `/${imgNum}.jpg`;\r\n  sourceImage.onload = () => {\r\n    sourceCanvas.width = sourceImage.width;\r\n    sourceCanvas.height = sourceImage.height;\r\n  };\r\n}\r\n\r\ndocument\r\n  .getElementById(\"firstImg\")\r\n  .addEventListener(\"click\", () => changeImage(1));\r\n\r\ndocument\r\n  .getElementById(\"secondImg\")\r\n  .addEventListener(\"click\", () => changeImage(2));\r\n\r\ndocument\r\n  .getElementById(\"thirdImg\")\r\n  .addEventListener(\"click\", () => changeImage(3));\r\n\r\ndocument\r\n  .getElementById(\"fourthImg\")\r\n  .addEventListener(\"click\", () => changeImage(4));\r\n\r\ndocument\r\n  .getElementById(\"fifthImg\")\r\n  .addEventListener(\"click\", () => changeImage(5));\r\n"]}